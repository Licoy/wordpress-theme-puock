"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var MobileSidebar=function(){function e(){_classCallCheck(this,e),this.init()}return _createClass(e,[{key:"init",value:function(){var e=this;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){e.initializeSidebar(),e.loadSidebarContent()}):(this.initializeSidebar(),this.loadSidebarContent()),window.InstantClick&&InstantClick.on("change",function(){e.initializeSidebar(),e.loadSidebarContent()})}},{key:"loadSidebarContent",value:function(){var i,e,t;window.puock_metas&&puock_metas.mobile_sidebar_enable&&((i=document.querySelector("#mobile-sidebar .mobile-sidebar-body"))&&(i.innerHTML='<div class="text-center py-4"><i class="fa fa-spinner fa-spin"></i> 加载中...</div>',e=new AbortController,t=setTimeout(function(){return e.abort()},5e3),fetch(window.location.href,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/html; charset=utf-8","Cache-Control":"no-cache"},signal:e.signal}).then(function(e){if(clearTimeout(t),!e.ok)throw new Error("HTTP error! status: ".concat(e.status));return e.text()}).then(function(e){var t=(new DOMParser).parseFromString(e,"text/html"),e=t.querySelector("#mobile-sidebar .mobile-sidebar-body");e||(t=t.querySelector("#sidebar .sidebar-main"))&&((e=document.createElement("div")).className="mobile-sidebar-body",e.innerHTML=t.innerHTML),e?(i.innerHTML=e.innerHTML,window.Puock&&(window.Puock.pageChangeInit(),window.Puock.lazyLoadInit(i),window.Puock.tooltipInit(i.querySelectorAll('[data-bs-toggle="tooltip"]')),console.log("侧边栏内容加载成功并初始化"))):(console.error("未找到侧边栏内容"),i.innerHTML='<div class="text-center py-4 text-danger">加载失败：未找到侧边栏内容</div>')}).catch(function(e){clearTimeout(t),"AbortError"===e.name?(console.error("侧边栏内容加载超时"),i.innerHTML='<div class="text-center py-4 text-danger">加载超时</div>'):(console.error("侧边栏内容加载失败:",e),i.innerHTML='<div class="text-center py-4 text-danger">加载失败：'.concat(e.message,"</div>"))})))}},{key:"initializeSidebar",value:function(){var e,t,i,a,n,r=this;window.puock_metas&&puock_metas.mobile_sidebar_enable&&(e=document.getElementById("mobile-sidebar-toggle"),t=document.getElementById("mobile-sidebar"),i=document.getElementById("mobile-sidebar-overlay"),a=document.getElementById("mobile-sidebar-close"),e&&t&&i&&a&&("true"===sessionStorage.getItem("mobileSidebarState")&&(t.classList.add("active"),i.classList.add("active"),e.classList.add("active"),(n=e.querySelector("i"))&&(n.classList.remove("fa-bars-progress"),n.classList.add("fa-circle-xmark"))),e.addEventListener("click",function(){return r.toggleSidebar(e,t,i)}),a.addEventListener("click",function(){return r.closeSidebar(e,t,i)}),i.addEventListener("click",function(){return r.closeSidebar(e,t,i)})))}},{key:"toggleSidebar",value:function(e,t,i){t.classList.contains("active")?this.closeSidebar(e,t,i):(t.classList.add("active"),i.classList.add("active"),e.classList.add("active"),(e=e.querySelector("i"))&&(e.classList.remove("fa-bars-progress"),e.classList.add("fa-circle-xmark")),sessionStorage.setItem("mobileSidebarState","true"))}},{key:"closeSidebar",value:function(e,t,i){t.classList.remove("active"),i.classList.remove("active"),e.classList.remove("active");e=e.querySelector("i");e&&(e.classList.remove("fa-circle-xmark"),e.classList.add("fa-bars-progress")),sessionStorage.setItem("mobileSidebarState","false")}}]),e}();window.addEventListener("load",function(){new MobileSidebar});